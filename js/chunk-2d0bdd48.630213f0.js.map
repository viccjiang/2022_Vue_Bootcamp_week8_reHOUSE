{"version":3,"sources":["webpack:///./src/views/UserFavorite.vue","webpack:///./src/views/UserFavorite.vue?cc42"],"names":["_createElementVNode","class","style","role","_hoisted_23","_createVNode","_component_Loading","active","_ctx","loader","color","_hoisted_1","$data","length","_createElementBlock","_hoisted_5","_component_router_link","to","_Fragment","key","_renderList","item","id","onClick","$options","includes","href","backgroundImage","imageUrl","_toDisplayString","category","title","description","price","origin_price","currency","type","_hoisted_20","disabled","status","loadingItem","_hoisted_24","storageMethods","save","favorite","favoriteString","JSON","stringify","localStorage","setItem","get","parse","getItem","data","products","product","pagination","categories","selectCategory","myFavorite","favorites","provide","emitter","methods","getProducts","url","process","this","isLoading","$http","then","response","console","log","success","getFavorites","favoriteIdArr","i","k","push","addMyFavorite","splice","indexOf","getCategories","Set","forEach","add","getProduct","$router","addCart","cart","product_id","qty","post","res","emit","watch","handler","deep","computed","filterProducts","filter","match","created","__exports__","render"],"mappings":"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","file":"js/chunk-2d0bdd48.630213f0.js","sourcesContent":["<template>\n  <Loading :active=\"isLoading\" loader=\"bars\" color=\"#236F6B\"> </Loading>\n  <div class=\"card border-0 rounded-0 bg-dark text-white mb-5\">\n    <img\n      class=\"filters\"\n      style=\"\n        height: 200px;\n        background-image: url(https://images.unsplash.com/photo-1616627408664-00fa6151580c?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80);\n        background-size: cover;\n        background-position: center bottom;\n        background-attachment: fixed;\n      \"\n    />\n    <div\n      class=\"\n        card-img-overlay\n        d-flex\n        flex-column\n        justify-content-center\n        align-item-center\n      \"\n    >\n      <h1 class=\"card-title text-center fw-bold\">願望清單</h1>\n    </div>\n  </div>\n  <div class=\"container mt-0 mt-md-10 mb-0 mb-md-10\">\n    <div class=\"g-4 row row-cols-1 row-cols-md-2 row-cols-lg-3 flex-column justify-content-center flex-md-row\">\n      <div\n        class=\"d-flex flex-column justify-content-center align-items-center\"\n        v-if=\"favorites.length === 0\"\n      >\n        <h3 class=\"h5 mb-4\">目前沒有收藏任何商品...</h3>\n        <router-link to=\"/products\" class=\"btn btn-soft\">\n          來去選購\n        </router-link>\n      </div>\n      <template v-else>\n      <div class=\"col\" v-for=\"item in favorites\" :key=\"item.id\">\n        <div class=\"card h-100 rounded-0 position-relative\">\n          <a\n            @click=\"addMyFavorite(item)\"\n            :class=\"{ active: myFavorite.includes(item.id) }\"\n            class=\"link-secondary d-block rounded-0\"\n          >\n            <i\n              v-if=\"myFavorite.includes(item.id)\"\n              class=\"\n                fs-5\n                bi bi-heart-fill\n                position-absolute\n                top-00\n                end-0\n                me-1\n                mt-1\n                text-danger\n              \"\n            ></i>\n            <i\n              v-else\n              class=\"\n                fs-5\n                bi bi-heart\n                position-absolute\n                top-00\n                end-0\n                me-1\n                mt-1\n                text-danger\n              \"\n            ></i>\n          </a>\n          <a href=\"#\" class=\"rounded-0\" @click.prevent=\"getProduct(item.id)\">\n            <div\n              style=\"\n                height: 300px;\n                background-size: cover;\n                background-position: center;\n              \"\n              :style=\"{ backgroundImage: `url(${item.imageUrl})` }\"\n            ></div>\n          </a>\n          <!-- <img :src=\"item.imageUrl\" class=\"card-img-top\" alt=\"...\" /> -->\n          <div class=\"card-body\">\n            <span class=\"badge bg-secondary text-light mb-2\">{{\n              item.category\n            }}</span>\n            <h5 class=\"card-title\">{{ item.title }}</h5>\n            <h6 class=\"h6 text-secondary\">\n              {{ item.description }}\n            </h6>\n\n            <div class=\"h5 list-inline-item\" v-if=\"!item.price\">\n              {{ item.origin_price }} 元\n            </div>\n            <del\n              class=\"h6 list-inline-item text-secondary mt-4\"\n              v-if=\"item.price\"\n              >原價 NT$ {{ $filters.currency(item.origin_price) }} 元</del\n            >\n            <div class=\"h5 text-danger mb-3\" v-if=\"item.price\">\n              NT$ {{ $filters.currency(item.price) }} 元\n            </div>\n            <div class=\"d-grid gap-2 d-md-flex justify-content-md-end\">\n              <button\n                class=\"btn btn-outline-secondary rounded-0 border\"\n                type=\"button\"\n                @click=\"getProduct(item.id)\"\n              >\n                查看更多\n              </button>\n              <button\n                class=\"btn btn-soft text-light rounded-0 border-0 me-md-2\"\n                type=\"button\"\n                :disabled=\"this.status.loadingItem === item.id\"\n                @click=\"addCart(item.id)\"\n              >\n                <div\n                  v-if=\"this.status.loadingItem === item.id\"\n                  class=\"spinner-border text-light spinner-border-sm\"\n                  role=\"status\"\n                >\n                  <span class=\"visually-hidden\">Loading...</span>\n                </div>\n                加到購物車\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n      </template>\n    </div>\n  </div>\n  <!-- 我的最愛 -->\n  <!-- {{ myFavorite.length }} -->\n</template>\n\n<script>\nimport emitter from '@/methods/emitter';\n// 我的最愛使用 LocalStorage 來存取\n// 因為LocalStorage不能存物件，所以要先轉型為字串\nconst storageMethods = {\n  // 存檔\n  save(favorite) {\n    // 丟進來的東西先做轉型 JSON.stringify\n    const favoriteString = JSON.stringify(favorite);\n    // hexFavorite 再做寫入，也就是把東西存進去\n    localStorage.setItem('hexFavorite', favoriteString);\n  },\n  // 取出\n  get() {\n    // 把 hexFavorite 欄位從 localStorage 取出時會是字串，所以要再用 JSON.parse 轉為物件\n    return JSON.parse(localStorage.getItem('hexFavorite'));\n  },\n};\nexport default {\n  data() {\n    return {\n      products: [], // getProducts\n      product: {},\n      pagination: {},\n      status: {\n        loadingItem: '', // 對應品項 id\n      },\n      categories: [], // 產品的分類項目\n      selectCategory: '', // 選取分類項目按鈕後，selectCategory = item，用 computed 做切換\n      myFavorite: storageMethods.get() || [], // 我的最愛，有品項的話就用 storageMethods.get() 取到內容，沒有的話就傳空陣列\n      favorites: [],\n    };\n  },\n  provide() {\n    return {\n      emitter,\n    };\n  },\n  methods: {\n    getProducts() {\n      const url = `${process.env.VUE_APP_API}/api/${process.env.VUE_APP_PATH}/products/all`;\n      this.isLoading = true;\n      this.$http.get(url).then((response) => {\n        console.log('取得 response：', response);\n        this.products = response.data.products;\n        this.isLoading = false;\n        if (response.data.success) {\n          console.log('取得所有產品：', response.data);\n          this.products = response.data.products;\n          this.getFavorites();\n        }\n      });\n    },\n    getFavorites() {\n      this.favorites = []; // 先給我的最愛空陣列\n      const favoriteIdArr = JSON.parse(localStorage.getItem('hexFavorite')) || []; // 把 hexFavorite 欄位從 localStorage 取出時會是字串，所以要再用 JSON.parse 轉為物件\n      console.log(favoriteIdArr);\n      for (let i = 0; i < this.products.length; i += 1) {\n        for (let k = 0; k < favoriteIdArr.length; k += 1) {\n          if (this.products[i].id === favoriteIdArr[k]) {\n            this.favorites.push(this.products[i]);\n          }\n        }\n      }\n    },\n    addMyFavorite(item) {\n      // console.log('addMyFavorite');\n      // this.myFavorite.push(item.id);\n      // this.myFavorite.includes(item.id) 原本是寫 item.id 存 id 就好，但後面要做其他事情可以先存整個物件\n      if (this.myFavorite.includes(item.id)) {\n        // 這裡意思是 如果我的最愛已經有這個品項，再按一次就代表取消\n        this.myFavorite.splice(this.myFavorite.indexOf(item.id), 1);\n        this.getFavorites();\n        this.getProducts();\n        // emitter.emit('update-favorite'); // 更新最愛數量\n      } else {\n        this.myFavorite.push(item.id); // 否則沒有此品項 就把品項加入\n        // emitter.emit('update-favorite'); // 更新最愛數量\n      }\n      console.log('myFavorite 我的最愛數量', this.myFavorite.length);\n      // storageMethods.save(this.myFavorite); // 儲存狀態\n      // emitter.emit('update-favorite'); // 更新最愛數量\n    },\n    getCategories() {\n      // Vue 3 雙向綁定 Proxy(new Proxy 物件)\n      // new Set\n      const categories = new Set(); // 建在全新的空的物件上\n      this.products.forEach((item) => {\n        categories.add(item.category); // 把品項加入 categories\n      });\n      console.log('取得所有分類 Set：', categories); // 這裡是 Set 屬於類陣列\n      this.categories = [...categories]; // 這裡要轉成純陣列的形式存回去  所以這裡要轉為 Proxy\n      console.log('取得所有分類 Proxy：', this.categories);\n    },\n    getProduct(id) {\n      this.$router.push(`/product/${id}`);\n    },\n    addCart(id) {\n      const url = `${process.env.VUE_APP_API}/api/${process.env.VUE_APP_PATH}/cart`;\n      this.status.loadingItem = id;\n      const cart = {\n        product_id: id,\n        qty: 1,\n      };\n      this.$http.post(url, { data: cart }).then((res) => {\n        this.status.loadingItem = '';\n        console.log(res);\n        emitter.emit('update-cart'); // 更新購物車數量\n      });\n    },\n  },\n  watch: {\n    // 監聽特定值\n    myFavorite: {\n      // 深層監聽\n      handler() {\n        storageMethods.save(this.myFavorite); // 把資料儲存\n        emitter.emit('update-favorite'); // 更新最愛數量\n      },\n      deep: true,\n    },\n  },\n  computed: {\n    // 產生新的資料集 (裡面的值產生變化之後，資料重新運算)\n    filterProducts() {\n      return this.products.filter((item) => item.category.match(this.selectCategory));\n      // 如果選到的產品品項是一樣的就呈現\n      // 監聽 this.products  this.selectCategory\n      // 空字串，或任何符合結果都會是 “真值”\n    },\n  },\n  created() {\n    // 改為 mounted\n    this.getProducts();\n  },\n};\n</script>\n","import { render } from \"./UserFavorite.vue?vue&type=template&id=5ad0222f\"\nimport script from \"./UserFavorite.vue?vue&type=script&lang=js\"\nexport * from \"./UserFavorite.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"D:\\\\六角學院\\\\2022春季 vue直播班\\\\week8_主線任務_FinalProject\\\\week8_FinalProject\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"sourceRoot":""}